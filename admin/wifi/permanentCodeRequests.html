<script src="/style/js/roleCheck.js"></script>
<script>
  checkRoleAccess(['wifiAdmin', 'superAdmin']); // Adjust roles as needed
</script>

<style>
  .action-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.action-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.action-controls label {
  display: flex;
  align-items: center;
  gap: 4px;
  margin: 0;
}

.search-box {
  max-width: 250px;
}

</style>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Permanent WiFi Code Requests</title>

  <!-- Load jQuery first -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="../../style/css/styles.css" />

  <!-- Additional Scripts -->
  <script src="../../style/js/plugin.js"></script>
  <script src="../../style/js/bootstrap-datepicker.min.js"></script>
  <script src="../../style/js/clockpicker.js"></script>
  <script src="../../style/js/custom.js"></script>
  <script src="../../style/js/config.js"></script>
  <script src="/sessionstorage.js"></script>
  <script src="permanentCodeRequests.js"></script>
  <script src="../../style/js/tableSortFilter.js" defer></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="../../style/js/exportToExcel.js"></script>
</head>
<body>
  <div class="header">
    <div class="container">
      <div class="logout">
        <a href="javascript:void(0);" onclick="history.back()">Back</a>
        &nbsp; | &nbsp; <a href="javascript:void(0);" onclick="goToHome()">Home</a> &nbsp; | &nbsp;
        <a href="javascript:void(0);" onclick="logout()">Logout</a>
      </div>
    </div>
  </div>

  <div class="middlecontent">
    <div class="container">
      <div class="whitesec">
        <div class="inner-padding">
          <div class="frm-head">
            <h1>Permanent WiFi Code Requests</h1>
          </div>

          <div class="form">
            <label>Status:
              <select id="statusFilter">
                <option value="">All</option>
                <option value="pending-new">Pending – New</option>
                <option value="pending-reset">Pending – Reset</option>
                <option value="approved">Approved</option>
                <option value="deleted">Deleted</option>
                <option value="rejected">Rejected</option>
              </select>
            </label>

        <div class="action-bar">
  <input
    type="text"
    id="tableSearch"
    class="form-control search-box"
    placeholder="Search..."
  />

  <div id="downloadBtnContainer" class="action-controls"></div>

  <button class="btn btn-success" onclick="openManualAddModal()">
    Add Code Manually
  </button>
</div>


            <div class="table-responsive">
              <table id="wifiRequestTable" class="table table-striped table-bordered">
                <thead>
  <tr>
    <th data-key="sr">Id</th>
    <th data-key="cardno">Card No</th>
    <th data-key="issuedto">Issued To</th>
    <th data-key="mobno">Mobile</th>
    <th data-key="email">Email Id</th>
    <th data-key="res_status">Res Status</th>
    <th data-key="requested_at">Requested At</th>
    <th data-key="username">User Name</th>
    <th data-key="ssid">SSID</th>
    <th data-key="code">Code</th>
    <th data-key="status">Status</th>
    <th>Action</th>
  </tr>
</thead>
<tbody></tbody>
              </table>
              <div id="pagination" style="margin-top: 10px;"></div>
              <div id="message" style="margin-top: 10px;"></div>
            </div>
          </div>

          <!-- Action Modal -->
          <!-- Modal Backdrop -->
<!-- Action Modal -->
<div id="modalBackdrop" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; overflow: auto;"></div>

<div id="actionModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; overflow: auto;">
  <div class="modal-content" style="background: white; padding: 2rem; margin: 5% auto; width: 90%; max-width: 500px; position: relative; border-radius: 10px;">
    <span onclick="closeModal()" style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;">&times;</span>

    <h2>Update WiFi Request</h2>
    <input type="hidden" id="modalRequestId" />

<div class="form-group">
  <div style="display: flex; align-items: center; gap: 6px;">
    <label style="margin: 0;">Current Status:</label>
    <span id="modalCurrentStatus" style="font-weight: 600;"></span>
  </div>
</div>

    <div class="form-group">
      <label for="modalNewStatus">New Status:</label>
      <select id="modalNewStatus" class="form-control">
  <option value="approved" selected>Approved</option>
  <option value="rejected">Rejected</option>
  <option value="deleted">Deleted</option>
</select>

    </div>

    <div class="form-group">
      <label for="modalUsername">User Name:</label>
      <input type="text" id="modalUsername" class="form-control" readonly/>
    </div>

    <div class="form-group">
  <label for="modalSsid">SSID:</label>
  <select id="modalSsid" class="form-control">
    <option value="">-- Select SSID --</option>
    <option value="SRATRC">SRATRC</option>
    <option value="BACKOFFICE">BACKOFFICE</option>
  </select>
</div>

    <div class="form-group">
      <label for="modalCode">Permanent Code (if approving):</label>
      <input type="text" id="modalCode" class="form-control" />
    </div>

    <div class="form-group">
      <label for="modalComments">Admin Comments:</label>
      <textarea id="modalComments" rows="3" class="form-control" style="width: 100%;"></textarea>
    </div>

    <div class="form-group form-submit" style="text-align: right;">
      <button onclick="submitAction()" class="btn btn-primary">Submit</button>
      <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
    </div>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
  <!-- Manual Add Backdrop -->
<div id="manualAddBackdrop"
     style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:9999;">
</div>

<!-- Manual Add Modal -->
<div id="manualAddModal"
     style="display:none; position:fixed; inset:0; z-index:10000; overflow:auto;">
  <div style="background:#fff; padding:2rem; margin:5% auto; max-width:500px; border-radius:10px; position:relative;">
    <span onclick="closeManualAddModal()"
          style="position:absolute; right:15px; top:10px; font-size:24px; cursor:pointer;">&times;</span>

    <h2>Add Permanent WiFi Code</h2>

    <div class="form-group">
      <label>Mobile No</label>
      <input type="text" id="manualMobno" class="form-control" onblur="fetchCardByMobno()" />
    </div>

    <div class="form-group">
      <label>Issued To</label>
      <input type="text" id="manualIssuedto" class="form-control" readonly />
    </div>

    <div class="form-group">
      <label>Card No</label>
      <input type="text" id="manualCardno" class="form-control" readonly />
    </div>

    <div class="form-group">
      <label>Res Status</label>
      <input type="text" id="manualResStatus" class="form-control" readonly />
    </div>

    <div class="form-group">
      <label>SSID</label>
      <select id="manualSsid" class="form-control">
        <option value="">-- Select --</option>
        <option value="SRATRC">SRATRC</option>
        <option value="BACKOFFICE">BACKOFFICE</option>
      </select>
    </div>

    <div class="form-group">
      <label>Device Type</label>
      <select id="manualDeviceType" class="form-control" onchange="autoGenerateUsername()">
        <option value="">-- Select --</option>
        <option value="MOBILE">Mobile</option>
        <option value="LAPTOP">Laptop</option>
        <option value="TABLET">Tablet</option>
        <option value="OTHER">Other</option>
      </select>
    </div>

    <div class="form-group">
      <label>Username</label>
      <input type="text" id="manualUsername" class="form-control" />
    </div>

    <div class="form-group">
      <label>Permanent Code</label>
      <input type="text" id="manualCode" class="form-control" />
    </div>

    <div style="text-align:right;">
      <button class="btn btn-primary" onclick="submitManualAdd()">Submit</button>
      <button class="btn btn-secondary" onclick="closeManualAddModal()">Cancel</button>
    </div>
  </div>
</div>

</body>
</html>
